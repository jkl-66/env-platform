# ç¯å¢ƒä¿æŠ¤è­¦ç¤ºå›¾åƒç”Ÿæˆå™¨ (APIç‰ˆæœ¬)

åŸºäº Hugging Face Inference API çš„ç¯å¢ƒä¿æŠ¤ä¸»é¢˜å›¾åƒç”Ÿæˆå·¥å…·ï¼Œé€šè¿‡äº‘ç«¯ Stable Diffusion 3.5 æ¨¡å‹ç”Ÿæˆå…·æœ‰ç¯å¢ƒè­¦ç¤ºæ„ä¹‰çš„å›¾åƒã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ¨ **äº‘ç«¯å›¾åƒç”Ÿæˆ**: åŸºäº Hugging Face Inference API è°ƒç”¨ Stable Diffusion 3.5 Large Turbo æ¨¡å‹
- ğŸŒ **ç¯å¢ƒä¸»é¢˜ä¼˜åŒ–**: ä¸“é—¨é’ˆå¯¹ç¯å¢ƒä¿æŠ¤åœºæ™¯ä¼˜åŒ–çš„æç¤ºè¯æ¨¡æ¿
- ğŸ”§ **è‡ªåŠ¨æç¤ºè¯å¢å¼º**: æ ¹æ®ç”¨æˆ·è¾“å…¥è‡ªåŠ¨ç”Ÿæˆä¸“ä¸šçš„ç¯å¢ƒè­¦ç¤ºæç¤ºè¯
- ğŸ“Š **å¤šç±»åˆ«æ”¯æŒ**: æ”¯æŒæµ·æ´‹æ±¡æŸ“ã€æ£®æ—ç ´åã€ç©ºæ°”æ±¡æŸ“ç­‰å¤šç§ç¯å¢ƒé—®é¢˜
- ğŸ’¾ **å®Œæ•´è®°å½•**: è‡ªåŠ¨ä¿å­˜ç”Ÿæˆå›¾åƒå’Œè¯¦ç»†çš„ç”ŸæˆæŠ¥å‘Š
- âš¡ **å¿«é€Ÿå¯åŠ¨**: æ— éœ€æœ¬åœ°æ¨¡å‹ä¸‹è½½ï¼Œå³å¼€å³ç”¨
- ğŸ’° **èµ„æºèŠ‚çœ**: æ— éœ€æœ¬åœ°GPUï¼ŒèŠ‚çœç¡¬ä»¶æˆæœ¬

## ç¯å¢ƒä¸»é¢˜

| ä¸»é¢˜ | æè¿° | å…³é”®è¯ |
|------|------|--------|
| ç©ºæ°”æ±¡æŸ“ | å·¥ä¸šæ±¡æŸ“ã€é›¾éœ¾ã€ç©ºæ°”è´¨é‡ | æ±¡æŸ“ã€é›¾éœ¾ã€å·¥å‚çƒŸå›± |
| æ°´æ±¡æŸ“ | æ²³æµæ±¡æŸ“ã€å·¥ä¸šåºŸæ°´ã€æœ‰æ¯’ç‰©è´¨ | æ°´æ±¡æŸ“ã€å·¥ä¸šåºŸæ°´ã€æ²³æµæ±¡æŸ“ |
| æ£®æ—ç ä¼ | å¤§è§„æ¨¡ç ä¼ã€ç”Ÿæ€ç ´åã€æ –æ¯åœ°ä¸§å¤± | æ£®æ—ç ä¼ã€æ¯æ—ã€ç”Ÿæ€ç ´å |
| æ°”å€™å˜åŒ– | å…¨çƒå˜æš–ã€å†°å·èåŒ–ã€æµ·å¹³é¢ä¸Šå‡ | æ°”å€™å˜åŒ–ã€å…¨çƒå˜æš–ã€å†°å·èåŒ– |
| å¡‘æ–™æ±¡æŸ“ | æµ·æ´‹åƒåœ¾ã€å¾®å¡‘æ–™ã€æµ·æ´‹ç”Ÿç‰©å½±å“ | å¡‘æ–™æ±¡æŸ“ã€æµ·æ´‹åƒåœ¾ã€å¾®å¡‘æ–™ |
| å¯å†ç”Ÿèƒ½æº | å¤ªé˜³èƒ½ã€é£èƒ½ã€æ¸…æ´æŠ€æœ¯ | å¯å†ç”Ÿèƒ½æºã€å¤ªé˜³èƒ½ã€é£èƒ½ |
| åºŸç‰©ç®¡ç† | åƒåœ¾å¡«åŸ‹ã€å›æ”¶ã€åºŸç‰©å¤„ç† | åƒåœ¾å¤„ç†ã€å›æ”¶ã€åºŸç‰©ç®¡ç† |
| ç”Ÿç‰©å¤šæ ·æ€§ | æ¿’å±ç‰©ç§ã€æ –æ¯åœ°ç ´åã€ç”Ÿæ€ç³»ç»Ÿ | ç”Ÿç‰©å¤šæ ·æ€§ã€æ¿’å±ç‰©ç§ã€ç”Ÿæ€ä¿æŠ¤ |
| åŸå¸‚æ±¡æŸ“ | äº¤é€šæ±¡æŸ“ã€åŸå¸‚çƒ­å²›ã€ç©ºæ°”è´¨é‡ | åŸå¸‚æ±¡æŸ“ã€äº¤é€šæ±¡æŸ“ã€åŸå¸‚ç¯å¢ƒ |
| åœŸå£¤é€€åŒ– | è’æ¼ åŒ–ã€åœŸåœ°ä¾µèš€ã€å†œä¸šæ±¡æŸ“ | åœŸå£¤é€€åŒ–ã€è’æ¼ åŒ–ã€åœŸåœ°ä¾µèš€ |

## ç¯å¢ƒè¦æ±‚

### ç¡¬ä»¶è¦æ±‚
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥
- **å†…å­˜**: 4GB+ ç³»ç»Ÿå†…å­˜
- **å­˜å‚¨**: 1GB+ å¯ç”¨ç©ºé—´ï¼ˆç”¨äºè¾“å‡ºå›¾åƒï¼‰

### è½¯ä»¶è¦æ±‚
- Python 3.8+
- Hugging Face Token (å…è´¹æ³¨å†Œè·å–)

## å®‰è£…æ­¥éª¤

### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd env-platform
```

### 2. å®‰è£…ä¾èµ–
```bash
# å®‰è£…åŸºæœ¬ä¾èµ–
pip install requests pillow

# æˆ–å®‰è£…å®Œæ•´ä¾èµ–
pip install -r requirements.txt
```

### 3. è·å– Hugging Face Token

1. è®¿é—® [Hugging Face](https://huggingface.co/)
2. æ³¨å†Œ/ç™»å½•è´¦æˆ·
3. è¿›å…¥ Settings â†’ Access Tokens
4. åˆ›å»ºæ–°çš„ Token (é€‰æ‹© "Read" æƒé™)
5. å¤åˆ¶ç”Ÿæˆçš„ Token

### 4. é…ç½®ç¯å¢ƒå˜é‡

**Windows:**
```cmd
set HF_TOKEN=your_token_here
```

**Linux/macOS:**
```bash
export HF_TOKEN="your_token_here"
```

## å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨

```python
from environmental_image_generator import EnvironmentalImageGenerator

# åˆå§‹åŒ–ç”Ÿæˆå™¨ (APIç‰ˆæœ¬)
generator = EnvironmentalImageGenerator()

# æµ‹è¯•APIè¿æ¥
if generator.test_api_connection():
    print("APIè¿æ¥æˆåŠŸï¼")
    
    # ç”Ÿæˆå›¾åƒ
    results = generator.generate_image(
        user_input="å·¥å‚æ’æ”¾é»‘çƒŸæ±¡æŸ“ç©ºæ°”çš„åœºæ™¯"
    )
    
    if results['success']:
        print(f"å›¾åƒå·²ä¿å­˜åˆ°: {results['image_paths'][0]}")
        print(f"ç”Ÿæˆæ—¶é—´: {results['generation_time']}ç§’")
    else:
        print(f"ç”Ÿæˆå¤±è´¥: {results['error']}")
else:
    print("APIè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥Tokenè®¾ç½®")
```

### 2. ä½¿ç”¨æ¼”ç¤ºè„šæœ¬

```bash
# è¿è¡Œäº¤äº’å¼æ¼”ç¤º (APIç‰ˆæœ¬)
python environmental_image_generator.py
```

```bash
# è¿è¡ŒåŠŸèƒ½æ¼”ç¤º (æ— éœ€Token)
python demo_without_token.py
```

æ¼”ç¤ºè„šæœ¬æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š
- APIè¿æ¥æµ‹è¯•
- è‡ªç„¶è¯­è¨€è¾“å…¥ç”Ÿæˆ
- ç¯å¢ƒç±»åˆ«æ£€æµ‹
- æç¤ºè¯å¢å¼ºæ¼”ç¤º

### 3. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡ŒAPIç‰ˆæœ¬æµ‹è¯• (éœ€è¦HF_TOKEN)
python test_api_generator.py
```

## é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶ä½äº `config/environmental_prompts.json`ï¼ŒåŒ…å«ï¼š

- **environmental_prompts**: ç¯å¢ƒä¸»é¢˜æç¤ºè¯æ¨¡æ¿
- **generation_settings**: ç”Ÿæˆè´¨é‡è®¾ç½®ï¼ˆé»˜è®¤ã€é«˜è´¨é‡ã€å¿«é€Ÿã€æ‰¹é‡ï¼‰
- **style_presets**: é£æ ¼é¢„è®¾ï¼ˆå†™å®ã€çºªå®ã€è‰ºæœ¯ã€ç§‘å­¦ã€æˆå‰§æ€§ï¼‰
- **quality_enhancers**: è´¨é‡å¢å¼ºè¯
- **negative_prompts**: è´Ÿé¢æç¤ºè¯

### è‡ªå®šä¹‰é…ç½®

æ‚¨å¯ä»¥ç¼–è¾‘é…ç½®æ–‡ä»¶æ¥ï¼š
- æ·»åŠ æ–°çš„ç¯å¢ƒä¸»é¢˜
- ä¿®æ”¹ç°æœ‰æç¤ºè¯æ¨¡æ¿
- è°ƒæ•´ç”Ÿæˆå‚æ•°
- æ·»åŠ æ–°çš„é£æ ¼é¢„è®¾

## ç”Ÿæˆå‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | æ¨èå€¼ |
|------|------|--------|
| guidance_scale | æç¤ºè¯éµå¾ªåº¦ | 7.5 (æ ‡å‡†), 9.0 (é«˜è´¨é‡) |
| num_inference_steps | æ¨ç†æ­¥æ•° | 28 (æ ‡å‡†), 35 (é«˜è´¨é‡), 20 (å¿«é€Ÿ) |
| height/width | å›¾åƒå°ºå¯¸ | 1024x1024 (é«˜è´¨é‡), 768x768 (å¿«é€Ÿ) |
| num_images | ç”Ÿæˆæ•°é‡ | 1 (å•å¼ ), 4 (æ‰¹é‡) |

## ä½¿ç”¨ç¤ºä¾‹

### ä¸­æ–‡è‡ªç„¶è¯­è¨€è¾“å…¥

```python
# ç©ºæ°”æ±¡æŸ“ä¸»é¢˜
results = generator.generate_image("å·¥å‚çƒŸå›±å†’å‡ºé»‘çƒŸï¼ŒåŸå¸‚è¢«é›¾éœ¾ç¬¼ç½©")

# æµ·æ´‹æ±¡æŸ“ä¸»é¢˜
results = generator.generate_image("æµ·æ´‹ä¸­æ¼‚æµ®ç€å¤§é‡å¡‘æ–™åƒåœ¾ï¼Œæµ·é¾Ÿè¢«å¡‘æ–™è¢‹ç¼ ç»•")

# æ£®æ—ç ´åä¸»é¢˜
results = generator.generate_image("å¤§ç‰‡æ£®æ—è¢«ç ä¼ï¼Œåªå‰©ä¸‹å…‰ç§ƒç§ƒçš„æ ‘æ¡©")
```

### è‹±æ–‡è‡ªç„¶è¯­è¨€è¾“å…¥

```python
# æ°”å€™å˜åŒ–ä¸»é¢˜
results = generator.generate_image("melting glaciers due to global warming, polar bears on shrinking ice")

# å¯å†ç”Ÿèƒ½æºä¸»é¢˜
results = generator.generate_image("solar panels and wind turbines in a clean energy landscape")
```

### ä½¿ç”¨é¢„è®¾æ¨¡æ¿

```python
import json

# åŠ è½½é…ç½®
with open('config/environmental_prompts.json', 'r', encoding='utf-8') as f:
    config = json.load(f)

# ä½¿ç”¨ç©ºæ°”æ±¡æŸ“æ¨¡æ¿
air_pollution = config['environmental_prompts']['air_pollution']
prompt = air_pollution['base_prompt']
style = config['style_presets']['documentary']

results = generator.generate_image(f"{prompt}, {style}")
```

## è¾“å‡ºæ–‡ä»¶

ç”Ÿæˆçš„å›¾åƒä¿å­˜åœ¨ `outputs/environmental_images/` ç›®å½•ä¸‹ï¼š

```
outputs/environmental_images/
â”œâ”€â”€ 20241201_143022_air_pollution/
â”‚   â”œâ”€â”€ image_001.png
â”‚   â””â”€â”€ generation_report.json
â”œâ”€â”€ 20241201_143156_water_pollution/
â”‚   â”œâ”€â”€ image_001.png
â”‚   â””â”€â”€ generation_report.json
â””â”€â”€ ...
```

æ¯æ¬¡ç”Ÿæˆéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¸¦æ—¶é—´æˆ³çš„æ–‡ä»¶å¤¹ï¼ŒåŒ…å«ï¼š
- ç”Ÿæˆçš„å›¾åƒæ–‡ä»¶ (PNG æ ¼å¼)
- ç”ŸæˆæŠ¥å‘Š (JSON æ ¼å¼ï¼ŒåŒ…å«å‚æ•°å’Œå…ƒæ•°æ®)

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **APIè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥Tokenè®¾ç½®
   echo $HF_TOKEN  # Linux/macOS
   echo %HF_TOKEN%  # Windows
   
   # é‡æ–°è®¾ç½®Token
   export HF_TOKEN="your_valid_token"  # Linux/macOS
   set HF_TOKEN=your_valid_token  # Windows
   ```

2. **ç”Ÿæˆå¤±è´¥ (401é”™è¯¯)**
   - æ£€æŸ¥Tokenæ˜¯å¦æœ‰æ•ˆ
   - ç¡®è®¤Tokenæœ‰æ¨¡å‹è®¿é—®æƒé™
   - é‡æ–°ç”ŸæˆToken

3. **ç”Ÿæˆé€Ÿåº¦æ…¢ (503é”™è¯¯)**
   - æ¨¡å‹æ­£åœ¨å†·å¯åŠ¨ï¼Œè¯·ç¨åé‡è¯•
   - é¿å…é¢‘ç¹è°ƒç”¨API
   - æ£€æŸ¥ç½‘ç»œè¿æ¥ç¨³å®šæ€§

4. **è¯·æ±‚é¢‘ç‡é™åˆ¶ (429é”™è¯¯)**
   - é™ä½APIè°ƒç”¨é¢‘ç‡
   - ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•
   - è€ƒè™‘å‡çº§Hugging Faceè´¦æˆ·

### æ€§èƒ½ä¼˜åŒ–

- ç¨³å®šçš„ç½‘ç»œè¿æ¥
- åˆç†çš„APIè°ƒç”¨é¢‘ç‡
- ä¼˜åŒ–æç¤ºè¯é•¿åº¦
- æ‰¹é‡å¤„ç†å¤šä¸ªè¯·æ±‚

## è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ª MIT è®¸å¯è¯ã€‚ä½¿ç”¨çš„ Stable Diffusion æ¨¡å‹è¯·éµå¾ªç›¸åº”çš„è®¸å¯è¯æ¡æ¬¾ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

---

**æ³¨æ„**: ç”Ÿæˆçš„å›¾åƒä»…ç”¨äºæ•™è‚²å’Œç¯ä¿å®£ä¼ ç›®çš„ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚